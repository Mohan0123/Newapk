<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranginx Creator Studio - Series Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- UI STYLES (STRICTLY UNCHANGED) --- */
        :root { --bg: #09090b; --surf: #18181b; --border: #27272a; --primary: #e50914; --text: #e4e4e7; --muted: #a1a1aa; }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background: #000; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .brand { color: var(--primary); font-size: 22px; font-weight: 800; margin-bottom: 30px; letter-spacing: 1px; }
        .menu-btn { padding: 12px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; color: var(--muted); font-weight: 600; font-size: 14px; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active { background: var(--surf); color: #fff; }
        .menu-btn.active { border-left: 3px solid var(--primary); }
        .main { flex: 1; display: flex; flex-direction: column; }
        .top-bar { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 30px; font-weight: 700; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); justify-content: space-between; }
        .scroll-view { flex: 1; overflow-y: auto; padding: 30px; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: var(--surf); padding: 25px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 25px; }
        .sec-title { font-size: 12px; text-transform: uppercase; color: var(--muted); margin-bottom: 20px; font-weight: 700; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full { grid-column: span 2; }
        label { display: block; margin-bottom: 8px; font-size: 13px; color: #ccc; font-weight: 600; }
        input, textarea { width: 100%; background: #09090b; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 6px; font-family: inherit; transition: 0.3s; font-size: 14px; }
        input:focus, textarea:focus { border-color: var(--primary); }
        textarea { height: 80px; resize: vertical; }
        .desc-box { height: 150px; }
        .ep-box { background: #000; padding: 15px; border-radius: 8px; border: 1px dashed var(--border); }
        .ep-list { margin-top: 15px; max-height: 200px; overflow-y: auto; }
        .ep-item { display: flex; justify-content: space-between; background: var(--surf); padding: 8px 12px; margin-bottom: 5px; border-radius: 4px; font-size: 13px; align-items: center; border: 1px solid var(--border); }
        .del-btn { color: #ef4444; cursor: pointer; font-weight: bold; padding: 5px; }
        .btn-row { display: flex; gap: 15px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; text-transform: uppercase; font-size: 13px; letter-spacing: 1px; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-secondary { background: #333; color: #fff; }
        .btn-add { background: var(--primary); color: #fff; padding: 0 20px; border-radius: 6px; font-weight: 700; cursor: pointer; border: none; }
        .output-area { display: none; margin-top: 40px; border-top: 1px dashed var(--border); padding-top: 30px; }
        .code-box { background: #000; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .box-head { background: #111; padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-size: 12px; font-weight: 700; color: var(--muted); }
        .copy-btn { background: var(--surf); color: #fff; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--border); cursor: pointer; font-size: 11px; font-weight: 600; }
        pre { padding: 15px; color: #4cd137; overflow-x: auto; font-family: monospace; font-size: 12px; max-height: 300px; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        @media (max-width: 768px) { .sidebar{width:70px;padding:15px 10px} .brand span, .menu-btn span{display:none} .brand{margin-bottom:20px;font-size:18px} .grid{grid-template-columns:1fr} }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">RANGINX <span>CREATOR</span></div>
    
    <div class="menu-btn active" onclick="switchTab(event,'series-main')">
        üì∫ <span>Series Home</span>
    </div>

    <div class="menu-btn" onclick="switchTab(event,'series-ep')">
        üéû <span>Episode Page</span>
    </div>
</div>

<div class="main">
    <div class="top-bar">
        <span id="pageTitle">Series Main Generator</span>
        <a href="/" class="btn-secondary" style="padding:8px 15px; border-radius:4px; font-size:12px; text-decoration:none; color:white;">üè† DASHBOARD</a>
    </div>
    
    <div class="scroll-view">
        <div class="container">
            
            <div id="tab-series-main" class="tab-panel active">
                <div class="card">
                    <div class="sec-title">Series Landing Page Data</div>
                    <div class="grid">
                        
                        <div class="full">
                            <label>Series Name (Slug auto-generated)</label>
                            <input type="text" id="mTitle" placeholder="e.g. Farzi Season 1">
                        </div>
                        <div>
                            <label>Poster / Thumbnail URL</label>
                            <input type="text" id="mPoster" placeholder="https://...">
                        </div>
                        <div>
                            <label>Genre / Tags</label>
                            <input type="text" id="mTags" placeholder="Crime, Thriller, Drama">
                        </div>
                        
                        <div class="full ep-box">
                            <label style="margin-bottom:10px">Episode List Builder</label>
                            <div class="grid" style="grid-template-columns: 0.5fr 1fr 1fr;">
                                <input type="number" id="listEpNum" placeholder="Ep No.">
                                <input type="text" id="listEpTitle" placeholder="Title (e.g. The Beginning)">
                                <input type="text" id="listEpThumb" placeholder="Thumbnail URL">
                            </div>
                            <button class="btn-add" style="width:100%; margin-top:10px;" onclick="addToList()">ADD EPISODE TO LIST</button>
                            <div id="epListDisplay" class="ep-list"></div>
                        </div>

                        <div class="full">
                            <label>SEO Title (Optional)</label>
                            <input type="text" id="mSeoTitle" placeholder="Auto-generated if empty">
                        </div>
                        <div class="full">
                            <label>Meta Description (Optional)</label>
                            <textarea id="mMeta" placeholder="Auto-generated if empty"></textarea>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="generateSeriesMain()">Generate Landing Page</button>
                        <button class="btn btn-secondary" onclick="resetForm('main')">Reset</button>
                    </div>
                </div>
            </div>

            <div id="tab-series-ep" class="tab-panel">
                <div class="card">
                    <div class="sec-title">Individual Episode Generator</div>
                    <div class="grid">
                         <div class="full">
                            <label>Parent Series Slug (For Back Button)</label>
                            <input type="text" id="eSeriesSlug" placeholder="e.g. farzi-season-1" style="color:var(--primary); font-weight:bold;">
                        </div>
                        <div style="grid-column: span 1">
                            <label>Episode Number</label>
                            <input type="number" id="eNum" placeholder="1">
                        </div>
                        <div style="grid-column: span 1">
                            <label>Episode Title</label>
                            <input type="text" id="eTitle" placeholder="The Pilot Episode">
                        </div>
                        <div class="full">
                            <label>Video URL (MP4 / Iframe)</label>
                            <input type="text" id="eVideo" placeholder="https://...">
                        </div>
                        <div class="full">
                            <label>Episode Thumbnail</label>
                            <input type="text" id="eThumb" placeholder="https://...">
                        </div>
                        
                        <div class="full">
                            <label>Episode Storyline (Auto-generated if empty)</label>
                            <textarea id="eDesc" class="desc-box" placeholder="Leave empty to auto-generate based on title..."></textarea>
                        </div>

                        <div class="full">
                            <label>SEO Title (Optional)</label>
                            <input type="text" id="eSeoTitle" placeholder="Auto-generated if empty">
                        </div>
                        <div class="full">
                            <label>Meta Description (Optional)</label>
                            <textarea id="eMeta" placeholder="Auto-generated if empty"></textarea>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" onclick="generateEpisodePage()">Generate Episode Page</button>
                        <button class="btn btn-secondary" onclick="resetForm('ep')">Reset</button>
                    </div>
                </div>
            </div>

            <div id="outputArea" class="output-area">
                <div class="code-box">
                    <div class="box-head">
                        <span>JSON Data (Database)</span>
                        <button class="copy-btn" onclick="copyText('jsonOut')">COPY JSON</button>
                    </div>
                    <pre id="jsonOut"></pre>
                </div>

                <div class="code-box">
                    <div class="box-head">
                        <span>HTML Code (Ready to Publish)</span>
                        <div style="display:flex; gap:10px">
                            <button class="copy-btn" onclick="copyText('htmlOut')">COPY HTML</button>
                            <button class="copy-btn" style="background:var(--primary);border:none" onclick="downloadHtml()">DOWNLOAD</button>
                        </div>
                    </div>
                    <pre id="htmlOut"></pre>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    let mainListEpisodes = [];
    let currentSlug = "";

    function switchTab(e, t) {
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
        e.currentTarget.classList.add('active');
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('tab-'+t).classList.add('active');
        
        if(t === 'series-main') document.getElementById('pageTitle').innerText = 'Series Main Generator';
        if(t === 'series-ep') document.getElementById('pageTitle').innerText = 'Episode Page Generator';
        
        document.getElementById('outputArea').style.display = 'none';
    }

    // --- LIST BUILDER LOGIC (NO DURATION) ---
    function addToList() {
        let n = document.getElementById('listEpNum').value.trim();
        let t = document.getElementById('listEpTitle').value.trim();
        let th = document.getElementById('listEpThumb').value.trim();
        
        if(!n || !t) return alert("Num and Title required!");
        
        mainListEpisodes.push({ num: n, title: t, thumb: th });
        renderList();
        document.getElementById('listEpNum').value = "";
        document.getElementById('listEpTitle').value = "";
        document.getElementById('listEpThumb').value = "";
    }

    function renderList() {
        let h = "";
        mainListEpisodes.forEach((e,i) => {
            h += `<div class="ep-item">
                <span><b>Ep ${e.num}:</b> ${e.title}</span> 
                <span class="del-btn" onclick="delFromList(${i})">√ó</span>
            </div>`;
        });
        document.getElementById('epListDisplay').innerHTML = h || '<div style="text-align:center;color:#555;font-size:12px;padding:10px">No episodes added</div>';
    }

    function delFromList(i) { mainListEpisodes.splice(i,1); renderList(); }
    
    function resetForm(type) {
        if(type === 'main') {
             document.querySelectorAll('#tab-series-main input, #tab-series-main textarea').forEach(e=>e.value='');
             mainListEpisodes = []; renderList();
        } else {
             document.querySelectorAll('#tab-series-ep input, #tab-series-ep textarea').forEach(e=>e.value='');
        }
    }

    // --- HELPER FUNCTIONS ---
    function sanitizeSlug(str) { 
        if(!str) return "";
        return str.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-'); 
    }
    function cleanStr(str) { return str ? str.replace(/"/g, '&quot;') : ""; }
    function cleanUrl(url) { return url ? url.trim().replace(/\s/g, '%20') : ""; }

    // ============================================
    //  Generate MAIN SERIES PAGE (No Storyline, No Duration)
    // ============================================
    function generateSeriesMain() {
        let titleRaw = document.getElementById('mTitle').value.trim();
        
        if(!titleRaw) return alert("Series Name is required!");

        let generatedSlug = sanitizeSlug(titleRaw);

        let data = {
            slug: generatedSlug,
            title: titleRaw,
            poster: cleanUrl(document.getElementById('mPoster').value),
            tags: document.getElementById('mTags').value,
            seo: document.getElementById('mSeoTitle').value,
            meta: document.getElementById('mMeta').value
        };

        let finalTitle = data.seo || `Watch ${data.title} All Episodes Online Free`;
        let finalMeta = data.meta || `Stream ${data.title} full web series in HD. All episodes available on Ranginx.`;
        
        // BUILD EPISODE HTML LIST (Removed Duration Badge)
        let epHtml = "";
        mainListEpisodes.sort((a,b)=>a.num - b.num).forEach(ep => {
            let epLink = `/series/${data.slug}/episode-${ep.num}.html`;
            epHtml += `
            <a href="${epLink}" class="ep-card">
                <div class="ep-thumb">
                    <img src="${ep.thumb || data.poster}" alt="Ep ${ep.num}" loading="lazy">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="ep-info">
                    <div class="ep-num">Episode ${ep.num}</div>
                    <div class="ep-title">${ep.title}</div>
                    <div class="ep-sub">Streaming Now</div>
                </div>
            </a>`;
        });

        let jsonDb = {
            type: "series",
            seriesSlug: data.slug,
            title: data.title,
            thumbnail: data.poster,
            episodes: mainListEpisodes.map(e => ({
                episode: parseInt(e.num),
                title: e.title,
                slug: `episode-${e.num}`,
                thumbnail: e.thumb
            }))
        };

        let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${cleanStr(finalTitle)}</title>
    <meta name="description" content="${cleanStr(finalMeta)}">
    <link rel="canonical" href="https://ranginx.fun/series/${data.slug}.html">
    <meta property="og:type" content="video.tv_show">
    <meta property="og:image" content="${data.poster}">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0f0f0f;--card:#1f1f1f;--p:#e50914;--t:#fff;}
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:var(--bg);color:var(--t);font-family:'Outfit',sans-serif;padding-bottom:50px}
        a{text-decoration:none;color:inherit}
        .hero{position:relative;height:55vh;width:100%;overflow:hidden}
        .hero::after{content:'';position:absolute;inset:0;background:linear-gradient(0deg, var(--bg) 0%, rgba(0,0,0,0.6) 50%, rgba(0,0,0,0.4) 100%)}
        .hero-img{width:100%;height:100%;object-fit:cover}
        .hero-content{position:absolute;bottom:0;left:0;width:100%;padding:20px;z-index:2;max-width:900px;margin:0 auto;right:0}
        h1{font-size:36px;font-weight:800;margin-bottom:10px;text-transform:uppercase;line-height:1.1;text-shadow:2px 2px 4px #000}
        .tags{display:flex;gap:10px;font-size:12px;color:#ccc;margin-bottom:15px;flex-wrap:wrap}
        .tag{background:rgba(255,255,255,0.2);padding:4px 10px;border-radius:4px;backdrop-filter:blur(5px)}
        
        .container{max-width:900px;margin:0 auto;padding:20px}
        .sec-head{font-size:20px;font-weight:700;margin-bottom:20px;border-left:5px solid var(--p);padding-left:15px}
        
        /* EPISODE LIST (Clean, No Duration) */
        .ep-list{display:flex;flex-direction:column;gap:15px}
        .ep-card{display:flex;background:var(--card);border-radius:8px;overflow:hidden;transition:0.2s;align-items:center;border:1px solid #333}
        .ep-card:hover{transform:translateX(5px);border-color:var(--p)}
        .ep-thumb{width:150px;aspect-ratio:16/9;position:relative;flex-shrink:0}
        .ep-thumb img{width:100%;height:100%;object-fit:cover}
        .play-icon{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.3);font-size:20px;opacity:0;transition:0.2s}
        .ep-card:hover .play-icon{opacity:1}
        .ep-info{padding:15px;flex:1}
        .ep-num{font-size:12px;color:var(--p);font-weight:700;text-transform:uppercase;margin-bottom:4px}
        .ep-title{font-size:16px;font-weight:600;margin-bottom:5px;line-height:1.2}
        .ep-sub{font-size:12px;color:#777}
        
        @media(max-width:600px){ .hero{height:45vh} h1{font-size:24px} .ep-thumb{width:120px} .ep-title{font-size:14px} }
    </style>
</head>
<body>

<div class="hero">
    <img src="${data.poster}" class="hero-img" alt="${cleanStr(data.title)}">
    <div class="hero-content">
        <h1>${data.title}</h1>
        <div class="tags">
            ${data.tags.split(',').map(t=>`<span class="tag">${t.trim()}</span>`).join('')}
        </div>
    </div>
</div>

<div class="container">
    <div class="sec-head">Episodes</div>
    <div class="ep-list">
        ${epHtml}
    </div>
</div>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TVSeries",
  "name": "${cleanStr(data.title)}",
  "image": "${data.poster}",
  "numberOfEpisodes": "${mainListEpisodes.length}"
}
<\/script>
</body>
</html>`;

        showOutput(html, JSON.stringify(jsonDb, null, 2), data.slug + "-main");
    }


    // ============================================
    //  Generate INDIVIDUAL EPISODE PAGE (With Storyline Auto-Gen)
    // ============================================
    function generateEpisodePage() {
        let data = {
            parentSlug: sanitizeSlug(document.getElementById('eSeriesSlug').value),
            num: document.getElementById('eNum').value,
            title: document.getElementById('eTitle').value,
            video: cleanUrl(document.getElementById('eVideo').value),
            thumb: cleanUrl(document.getElementById('eThumb').value),
            desc: document.getElementById('eDesc').value.trim(), // STORYLINE
            seo: document.getElementById('eSeoTitle').value,
            meta: document.getElementById('eMeta').value
        };

        if(!data.parentSlug || !data.num || !data.video) return alert("Series Slug, Ep Num & Video URL required!");

        // AUTO-GENERATE STORYLINE IF EMPTY
        if(!data.desc) {
            data.desc = `Watch ${data.title} (Episode ${data.num}) online. This episode is part of the ${data.parentSlug} series. Stream in high quality for free on Ranginx. Don't miss the drama and action unfold in this latest episode.`;
        }

        let slug = `episode-${data.num}`;
        let fullTitle = data.seo || `${data.title} - Episode ${data.num}`;
        let playerCode = "";
        
        if(data.video.includes('.mp4') || data.video.includes('.mkv')) {
            playerCode = `<video controls playsinline poster="${data.thumb}" class="player"><source src="${data.video}" type="video/mp4"></video>`;
        } else {
            playerCode = `<iframe src="${data.video}" allowfullscreen class="player"></iframe>`;
        }

        let jsonDb = {
            type: "episode",
            series: data.parentSlug,
            episode: parseInt(data.num),
            title: data.title,
            video: data.video,
            storyline: data.desc
        };

        let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${cleanStr(fullTitle)}</title>
    <meta name="description" content="${cleanStr(data.meta)}">
    <link rel="canonical" href="https://ranginx.fun/series/${data.parentSlug}/${slug}.html">
    <meta property="og:type" content="video.episode">
    <meta property="og:image" content="${data.thumb}">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0f0f0f;--card:#1f1f1f;--p:#e50914;--t:#fff;}
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:var(--bg);color:var(--t);font-family:'Outfit',sans-serif;}
        a{text-decoration:none;color:inherit}
        .header{padding:15px;background:#000;border-bottom:1px solid #222;display:flex;align-items:center;gap:10px}
        .back-btn{padding:8px 15px;background:var(--card);border-radius:4px;font-size:12px;font-weight:700}
        .main-stage{width:100%;max-width:1100px;margin:0 auto;}
        .video-box{width:100%;aspect-ratio:16/9;background:#000;}
        .player{width:100%;height:100%;border:none;object-fit:contain}
        .info-sec{padding:20px;}
        h1{font-size:22px;margin-bottom:15px;}
        
        /* STORYLINE STYLE */
        .story-box{background:var(--card);padding:20px;border-radius:8px;margin-bottom:20px;line-height:1.6;color:#ccc;border:1px solid #333}
        
        .ep-nav{display:flex;justify-content:space-between;margin-top:20px;padding-top:20px;border-top:1px solid #333}
        .nav-btn{background:var(--card);padding:10px 20px;border-radius:5px;font-weight:600}
        @media(max-width:768px){ h1{font-size:18px} }
    </style>
</head>
<body>

<div class="header">
    <a href="../${data.parentSlug}.html" class="back-btn">‚¨Ö Back to Series</a>
    <div style="font-weight:700;color:var(--p)">RANGINX</div>
</div>

<div class="main-stage">
    <div class="video-box">
        ${playerCode}
    </div>
    <div class="info-sec">
        <h1>Episode ${data.num}: ${data.title}</h1>
        
        <div class="story-box">
            ${data.desc}
        </div>
        
        <div class="ep-nav">
             <a href="../${data.parentSlug}.html" class="nav-btn" style="width:100%;text-align:center">All Episodes</a>
        </div>
    </div>
</div>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TVEpisode",
  "episodeNumber": "${data.num}",
  "name": "${cleanStr(data.title)}",
  "description": "${cleanStr(data.desc)}",
  "image": "${data.thumb}",
  "partOfSeries": {
    "@type": "TVSeries",
    "name": "${data.parentSlug}"
  }
}
<\/script>
</body>
</html>`;

        showOutput(html, JSON.stringify(jsonDb, null, 2), `${data.parentSlug}-ep${data.num}`);
    }

    // --- OUTPUT UTILS ---
    function showOutput(h, j, s) {
        currentSlug = s;
        document.getElementById('htmlOut').textContent = h;
        document.getElementById('jsonOut').textContent = j;
        document.getElementById('outputArea').style.display = 'block';
        document.getElementById('outputArea').scrollIntoView({behavior:'smooth'});
    }

    function copyText(id){
        let t=document.getElementById(id).textContent;
        navigator.clipboard.writeText(t).then(()=>alert("Copied!"));
    }

    function downloadHtml(){
        if(!currentSlug) return alert("Generate first!");
        let b=new Blob([document.getElementById('htmlOut').textContent],{type:'text/html'});
        let a=document.createElement('a');
        a.href=URL.createObjectURL(b);
        a.download=currentSlug+".html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>
</body>
</html>
