<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranginx - Premium Streaming</title>
    
    <meta name="description" content="Watch latest HD web series and movies online for free on Ranginx.">
    <meta name="robots" content="index, follow">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ranginx - Premium Streaming">
    <meta property="og:description" content="Watch latest HD web series and movies online.">
    <meta property="og:image" content="https://ranginx.fun/og-image.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { brand: '#e50914', dark: { bg: '#0a0a0a', card: '#121212', border: '#262626' } },
                    animation: { 'fade': 'fadeIn 0.3s ease-out', 'pop': 'popIn 0.2s ease-out' },
                    keyframes: { 
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        popIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0a0a0a; color: #e5e5e5; font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #e50914; }
        .glass-nav { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #262626; }
        
        /* Modal Styles */
        .legal-content h2 { color: white; font-size: 1.2rem; font-weight: bold; margin-top: 1rem; margin-bottom: 0.5rem; }
        .legal-content p { color: #a3a3a3; font-size: 0.9rem; line-height: 1.6; margin-bottom: 1rem; }
        .legal-content ul { list-style: disc; margin-left: 1.5rem; color: #a3a3a3; margin-bottom: 1rem; }
    </style>
</head>
<body>

<nav class="fixed top-0 w-full h-16 glass-nav z-[60] flex items-center justify-between px-4 lg:px-8">
    <div class="flex items-center gap-6">
        <a href="/" class="spa-link text-2xl font-bold tracking-tighter text-white">
            <span class="text-brand">Rang</span>inx
        </a>
        <div class="hidden md:flex gap-4 text-sm font-medium text-gray-400">
            <a href="/" class="spa-link hover:text-white transition">Home</a>
            <a href="/" onclick="filterType('movie')" class="hover:text-white transition cursor-pointer">Movies</a>
            <a href="/" onclick="filterType('series')" class="hover:text-white transition cursor-pointer">Web Series</a>
        </div>
    </div>

    <div class="flex-grow max-w-md mx-4 relative hidden md:block">
        <input type="text" id="search-input" placeholder="Search..." class="w-full bg-[#141414] border border-[#262626] pl-10 pr-4 py-2 rounded-full text-sm text-white focus:border-brand outline-none">
        <i data-lucide="search" class="w-4 h-4 text-gray-500 absolute left-3.5 top-2.5"></i>
    </div>
    
    <button class="md:hidden text-white" onclick="document.getElementById('mobile-search').classList.toggle('hidden')">
        <i data-lucide="search" class="w-6 h-6"></i>
    </button>
</nav>

<div id="mobile-search" class="fixed top-16 left-0 w-full bg-[#0a0a0a] p-4 hidden z-50 border-b border-[#262626]">
    <input type="text" id="mobile-search-input" placeholder="Search..." class="w-full bg-[#141414] border border-[#262626] p-3 rounded text-white">
</div>

<main id="app" class="pt-20 min-h-screen pb-10"></main>

<footer class="border-t border-[#262626] bg-[#050505] pt-10 pb-6 mt-10">
    <div class="max-w-[1600px] mx-auto px-4 text-center">
        <div class="flex justify-center gap-6 mb-6 text-sm text-gray-400">
            <button onclick="openModal('dmca')" class="hover:text-brand transition">DMCA</button>
            <button onclick="openModal('privacy')" class="hover:text-brand transition">Privacy Policy</button>
            <button onclick="openModal('terms')" class="hover:text-brand transition">Terms & Conditions</button>
        </div>
        <p class="text-[11px] text-[#444]">&copy; 2026 Ranginx. All rights reserved. <br>Disclaimer: This site does not store any files on its server. All contents are provided by non-affiliated third parties.</p>
    </div>
</footer>

<div id="legal-modal" class="fixed inset-0 z-[100] hidden items-center justify-center animate-fade">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeModal()"></div>
    
    <div class="relative bg-[#141414] border border-[#262626] w-full max-w-2xl max-h-[80vh] rounded-xl shadow-2xl flex flex-col animate-pop mx-4">
        <div class="flex justify-between items-center p-5 border-b border-[#262626]">
            <h2 id="modal-title" class="text-xl font-bold text-white">Legal</h2>
            <button onclick="closeModal()" class="p-1 hover:bg-[#262626] rounded-full text-gray-400 hover:text-white transition">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        
        <div id="modal-body" class="p-6 overflow-y-auto legal-content">
            </div>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    const STATE = {
        data: [],
        playerInstance: null,
        hls: null
    };

    // --- LEGAL CONTENT TEXT ---
    const LEGAL_TEXT = {
        dmca: `
            <h2>DMCA Copyright Infringement Notification</h2>
            <p>Ranginx respects the intellectual property rights of others. Ranginx operates as a search engine and does not host, upload, or store any video files on its servers. All content is provided by non-affiliated third parties.</p>
            <p>If you believe that your copyrighted work has been copied in a way that constitutes copyright infringement and is accessible on this site, please notify our copyright agent.</p>
            <h2>Counter-Notice</h2>
            <p>If you believe that your content was removed by mistake, you may file a counter-notice containing your identification and a statement under penalty of perjury.</p>
        `,
        privacy: `
            <h2>Privacy Policy</h2>
            <p>At Ranginx, accessible from ranginx.fun, one of our main priorities is the privacy of our visitors. This Privacy Policy document contains types of information that is collected and recorded by Ranginx and how we use it.</p>
            <h2>Log Files</h2>
            <p>Ranginx follows a standard procedure of using log files. These files log visitors when they visit websites. The information collected by log files includes internet protocol (IP) addresses, browser type, Internet Service Provider (ISP), date and time stamp.</p>
            <h2>Cookies</h2>
            <p>Like any other website, Ranginx uses 'cookies'. These cookies are used to store information including visitors' preferences, and the pages on the website that the visitor accessed or visited.</p>
        `,
        terms: `
            <h2>Terms and Conditions</h2>
            <p>Welcome to Ranginx! These terms and conditions outline the rules and regulations for the use of Ranginx's Website.</p>
            <h2>Cookies</h2>
            <p>We employ the use of cookies. By accessing Ranginx, you agreed to use cookies in agreement with the Ranginx's Privacy Policy.</p>
            <h2>License</h2>
            <p>Unless otherwise stated, Ranginx and/or its licensors own the intellectual property rights for all material on Ranginx. All intellectual property rights are reserved.</p>
            <h2>Disclaimer</h2>
            <p>To the maximum extent permitted by applicable law, we exclude all representations, warranties and conditions relating to our website and the use of this website.</p>
        `
    };

    // --- 1. INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', async () => {
        document.body.addEventListener('click', e => {
            const link = e.target.closest('a.spa-link');
            if (link) {
                e.preventDefault();
                history.pushState(null, '', link.href);
                router();
            }
        });

        const handleSearch = (e) => filterContent(e.target.value);
        document.getElementById('search-input').addEventListener('keyup', handleSearch);
        document.getElementById('mobile-search-input').addEventListener('keyup', handleSearch);

        if(window.lucide) lucide.createIcons();
        await loadData();
    });

    window.addEventListener('popstate', router);

    // --- 2. DATA LOADING ---
    async function loadData() {
        renderSkeleton();
        try {
            const response = await fetch('data/normal.json');
            if (!response.ok) throw new Error("File not found");
            const json = await response.json();
            STATE.data = json.reverse();
            router();
        } catch (error) {
            console.error(error);
            document.getElementById('app').innerHTML = `<div class="h-[60vh] flex flex-col justify-center items-center text-center"><h2 class="text-white font-bold">Content Load Error</h2><p class="text-gray-500">Check /data/normal.json</p></div>`;
        }
    }

    // --- 3. ROUTER & SEO ---
    function router() {
        window.scrollTo(0, 0);
        destroyPlayer(); // Destroy player instance properly
        document.body.classList.remove('cinema-mode');

        const path = window.location.pathname;
        const slug = path.substring(1); 

        document.getElementById('mobile-search').classList.add('hidden');

        if (path === '/' || path === '/index.html' || path === '') {
            renderHome(STATE.data);
            updateSEO('Ranginx - Watch Movies & Web Series', 'Watch the latest HD movies and web series online for free.');
        } else if (slug) {
            const item = STATE.data.find(i => i.slug === slug);
            if (item) renderWatch(item);
            else render404();
        }
    }

    // SEO Helper
    function updateSEO(title, desc) {
        document.title = title;
        const metaDesc = document.querySelector('meta[name="description"]');
        if(metaDesc) metaDesc.setAttribute('content', desc);
        
        // Update OG Tags
        const ogTitle = document.querySelector('meta[property="og:title"]');
        if(ogTitle) ogTitle.setAttribute('content', title);
        
        const ogDesc = document.querySelector('meta[property="og:description"]');
        if(ogDesc) ogDesc.setAttribute('content', desc);
    }

    // --- 4. RENDER FUNCTIONS ---
    function renderSkeleton() {
        document.getElementById('app').innerHTML = `<div class="w-full h-96 bg-[#141414] animate-pulse mx-auto max-w-[1600px] mt-6 rounded-xl"></div>`;
    }

    function renderHome(list) {
        const featured = list[0];
        const gridItems = list.slice(1);
        let html = `<div class="px-4 lg:px-8 max-w-[1600px] mx-auto animate-fade">`;

        if (featured) {
            html += `
            <div class="relative w-full h-[50vh] md:h-[60vh] rounded-2xl overflow-hidden mb-12 group border border-[#262626]">
                <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('${featured.thumbnail}');"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a]/50 to-transparent"></div>
                <div class="absolute bottom-0 left-0 p-6 md:p-12 w-full md:w-2/3">
                    <span class="bg-brand text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider mb-3 inline-block">Featured</span>
                    <h1 class="text-3xl md:text-5xl font-bold text-white mb-4 leading-tight drop-shadow-md">${featured.title}</h1>
                    <a href="/${featured.slug}" class="spa-link inline-flex items-center gap-2 bg-white text-black px-6 py-3 rounded-lg font-bold hover:bg-gray-200 transition">
                        <i data-lucide="play" class="w-5 h-5 fill-black"></i> Watch Now
                    </a>
                </div>
            </div>`;
        }

        html += `<h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="grid" class="text-brand w-5 h-5"></i> Latest Uploads</h2>
                 <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-4 gap-y-8">`; // Adjusted grid for mobile

        gridItems.forEach(item => {
            const isSeries = item.type && item.type.toLowerCase().includes('series');
            html += `
                <a href="/${item.slug}" class="spa-link group block relative">
                    <div class="relative aspect-video rounded-lg overflow-hidden mb-3 bg-[#141414] border border-[#222]"> <img src="${item.thumbnail}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500" loading="lazy">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                             <div class="bg-brand/90 p-3 rounded-full shadow-xl transform scale-50 group-hover:scale-100 transition"><i data-lucide="play" class="w-6 h-6 fill-white text-white"></i></div>
                        </div>
                        <span class="absolute top-2 right-2 bg-black/80 text-white text-[10px] font-bold px-1.5 py-0.5 rounded border border-white/10 uppercase">${isSeries ? 'Series' : 'Movie'}</span>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-200 line-clamp-1 group-hover:text-brand transition">${item.title}</h3>
                        <div class="flex items-center justify-between mt-1 text-[11px] text-gray-500">
                            <span>${item.date || '2025'}</span>
                            <span class="border border-[#333] px-1 rounded">${item.category || 'HD'}</span>
                        </div>
                    </div>
                </a>`;
        });
        html += `</div></div>`;
        document.getElementById('app').innerHTML = html;
        lucide.createIcons();
    }

    function renderWatch(item) {
        // SEO UPDATE for specific movie/series
        const descText = item.description || `Watch ${item.title} online for free in HD on Ranginx.`;
        updateSEO(`Watch ${item.title} - Ranginx`, descText);

        const isSeries = item.episodes && item.episodes.length > 0;
        const initialSrc = isSeries ? item.episodes[0].url : item.video;
        const initialTitle = isSeries ? `${item.title} - Episode 1` : item.title;
        const suggestions = STATE.data.filter(i => i.slug !== item.slug).slice(0, 8);

        let html = `
        <div id="watch-container" class="max-w-[1600px] mx-auto px-4 lg:px-8 py-6 animate-fade">
            <div class="text-sm text-gray-500 mb-4 flex items-center gap-2">
                <a href="/" class="spa-link hover:text-white">Home</a> <i data-lucide="chevron-right" class="w-3 h-3"></i> <span class="text-brand">${item.title}</span>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <div class="w-full lg:w-[75%] player-container transition-all duration-300">
                    <div class="relative rounded-xl overflow-hidden border border-[#262626] player-glow bg-black">
                        <div id="player-wrapper" class="aspect-video w-full bg-black">
                            </div>
                    </div>

                    <div class="mt-4 flex justify-between items-center">
                        <h1 id="player-title" class="text-2xl md:text-3xl font-bold text-white leading-tight">${initialTitle}</h1>
                        <button onclick="toggleCinemaMode()" class="flex items-center gap-2 text-xs bg-[#262626] text-white px-3 py-2 rounded hover:bg-brand transition">
                            <i data-lucide="monitor" class="w-4 h-4"></i> Cinema Mode
                        </button>
                    </div>

                    <div class="mt-2 flex flex-wrap gap-3 mb-6">
                        <span class="bg-[#262626] text-gray-300 text-xs px-2 py-1 rounded border border-[#333]">${item.category || 'HD'}</span>
                        <span class="bg-[#262626] text-gray-400 text-xs px-2 py-1 rounded border border-[#333]">${item.date}</span>
                    </div>

                    <div class="bg-[#111] p-6 rounded-xl border border-[#262626] mb-8">
                        <h3 class="text-white font-bold mb-2 flex items-center gap-2"><i data-lucide="info" class="text-brand w-4 h-4"></i> Storyline</h3>
                        <p class="text-gray-400 text-sm leading-relaxed">${item.description || 'No description available.'}</p>
                    </div>

                    ${isSeries ? `
                    <div class="mb-10">
                        <h3 class="text-white font-bold mb-4 flex items-center gap-2"><i data-lucide="layers" class="text-brand w-4 h-4"></i> Episodes</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
                            ${item.episodes.map((ep, idx) => `
                                <button onclick="changeSource('${ep.url}', '${item.title} - Episode ${ep.ep}', '${item.thumbnail}', this)" 
                                    class="ep-btn ${idx === 0 ? 'bg-brand text-white border-brand' : 'bg-[#1a1a1a] text-gray-400 border-[#333] hover:bg-[#222]'} 
                                    border rounded p-3 text-sm font-medium transition text-center truncate">
                                    Ep ${ep.ep}: ${ep.title}
                                </button>
                            `).join('')}
                        </div>
                    </div>` : ''}
                </div>

                <div class="w-full lg:w-[25%] sidebar-recs">
                    <h3 class="text-white font-bold mb-4 border-l-4 border-brand pl-3">Recommended</h3>
                    <div class="flex flex-col gap-3">
                        ${suggestions.map(s => `
                        <a href="/${s.slug}" class="spa-link flex gap-3 p-2 rounded hover:bg-[#1a1a1a] transition group">
                            <div class="w-24 h-32 bg-[#222] rounded flex-shrink-0 overflow-hidden relative">
                                <img src="${s.thumbnail}" class="w-full h-full object-cover group-hover:scale-105 transition">
                            </div>
                            <div class="flex flex-col justify-center min-w-0">
                                <h4 class="text-white text-sm font-semibold truncate group-hover:text-brand">${s.title}</h4>
                                <span class="text-xs text-gray-500 mt-1 flex items-center gap-1"><i data-lucide="star" class="w-3 h-3 text-brand"></i> ${s.category || 'Movie'}</span>
                            </div>
                        </a>`).join('')}
                    </div>
                </div>
            </div>
        </div>`;

        document.getElementById('app').innerHTML = html;
        lucide.createIcons();
        
        // Initialize player for the first time
        const wrapper = document.getElementById('player-wrapper');
        wrapper.innerHTML = getVideoHTML(initialSrc, item.thumbnail);
        initPlayer(initialSrc); 
    }

    function render404() {
        document.getElementById('app').innerHTML = `<div class="min-h-[60vh] flex flex-col items-center justify-center text-center px-4"><h1 class="text-6xl font-bold text-brand mb-4">404</h1><p class="text-xl text-gray-300 mb-8">Page Not Found.</p><a href="/" class="spa-link bg-white text-black px-6 py-2 rounded font-bold">Home</a></div>`;
    }

    // --- 5. PLAYER LOGIC (With HLS Support) ---
    function destroyPlayer() {
        if (STATE.hls) {
            STATE.hls.destroy();
            STATE.hls = null;
        }
        if (STATE.playerInstance) {
            STATE.playerInstance.destroy();
            STATE.playerInstance = null;
        }
    }

    function getVideoHTML(url, poster) {
        // Simple heuristic: if it's likely a video file, use video tag. Otherwise iframe.
        // HLS streams (.m3u8) also use video tag but need HLS.js logic.
        const isVideoFile = url.includes('.mp4') || url.includes('.mkv') || url.includes('.webm') || url.includes('.m3u8');
        
        if (isVideoFile) {
            return `<video id="plyr-video" playsinline controls data-poster="${poster}" class="w-full h-full object-contain bg-black"></video>`;
        } else {
            return `<iframe src="${url}" class="w-full h-full absolute inset-0 border-0" allowfullscreen allow="autoplay"></iframe>`;
        }
    }

    function initPlayer(src) {
        // If it's an iframe, no Plyr init needed
        if (!src.includes('.mp4') && !src.includes('.mkv') && !src.includes('.webm') && !src.includes('.m3u8')) return;

        const video = document.getElementById('plyr-video');
        if (!video) return;

        // Check for HLS
        if (Hls.isSupported() && src.includes('.m3u8')) {
            const hls = new Hls();
            hls.loadSource(src);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                STATE.playerInstance = new Plyr(video);
            });
            STATE.hls = hls;
        } else {
            // Standard video
            video.src = src;
            STATE.playerInstance = new Plyr(video);
        }
    }

    window.changeSource = (url, title, poster, btn) => {
        const wrapper = document.getElementById('player-wrapper');
        
        // Destroy existing player/hls instances
        destroyPlayer();

        // Update DOM for new source
        wrapper.innerHTML = getVideoHTML(url, poster);
        document.getElementById('player-title').innerText = title;
        
        // Re-initialize player
        initPlayer(url);

        // Update UI buttons
        document.querySelectorAll('.ep-btn').forEach(b => {
            b.classList.remove('bg-brand', 'text-white', 'border-brand');
            b.classList.add('bg-[#1a1a1a]', 'text-gray-400', 'border-[#333]');
        });
        btn.classList.remove('bg-[#1a1a1a]', 'text-gray-400', 'border-[#333]');
        btn.classList.add('bg-brand', 'text-white', 'border-brand');
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.toggleCinemaMode = () => {
        document.body.classList.toggle('cinema-mode');
        if(document.body.classList.contains('cinema-mode')) document.querySelector('.player-container').scrollIntoView();
    };
    
    window.filterType = (type) => {
        const filtered = STATE.data.filter(i => i.type && i.type.toLowerCase().includes(type));
        renderHome(filtered);
    };
    
    window.filterContent = (val) => {
        if(!val) return renderHome(STATE.data);
        const filtered = STATE.data.filter(i => i.title.toLowerCase().includes(val.toLowerCase()));
        if(window.location.pathname !== '/') history.pushState(null, '', '/');
        renderHome(filtered);
    };
</script>

</body>
</html>
